version: '3.1'

services:
  mysql_db:
    image: mysql:latest
    environment:
      MYSQL_ROOT_PASSWORD: root
    ports:
      - "3307:3306"
    volumes:
      - ./database/initial_script.sql:/docker-entrypoint-initdb.d/init.sql
      - ./database/T_ONTIME_MARKETING.csv:/var/lib/mysql-files/T_ONTIME_MARKETING.csv
      - ./database/L_UNIQUE_CARRIERS.csv:/var/lib/mysql-files/L_UNIQUE_CARRIERS.csv

#  hbase:
#    image: dajobe/hbase
#    ports:
#      - "16010:16010" # Port for HBase Master web UI

  custom_sqoop:
    build:
      context: .
      dockerfile: SqoopDockerfile
    depends_on:
      - mysql_db
    environment:
      - HBASE_HOME=/opt/hbase
      - CLASSPATH=/jdbc/mysql-connector-j.jar:$CLASSPATH
    volumes:
      - ./Dependencies/mysql-connector-j.jar:/usr/local/sqoop/lib/mysql-connector-j.jar
    command: >
      sh -c "
        while ! nc -z mysql_db 3306; do sleep 10; echo 'ping' ; done;
        sleep 1000;
        sqoop import --connect jdbc:mysql://mysql_db:3306/HPC --username root --password root --table airlineAirportData --hbase-table airlines --column-family cf --hbase-create-table --hbase-row-key id"

